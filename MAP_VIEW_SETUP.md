# 🗺️ 地图视图设置指南

## 功能说明

地图视图让你可以直观地看到所有餐厅的地理位置，方便选择离你最近的餐厅。

---

## 🚀 快速设置（3步完成）

### 步骤 1: 更新数据库结构

在 **Supabase Dashboard** 的 **SQL Editor** 中执行：

```sql
-- Add latitude and longitude columns to restaurants table
ALTER TABLE restaurants 
ADD COLUMN IF NOT EXISTS latitude DOUBLE PRECISION,
ADD COLUMN IF NOT EXISTS longitude DOUBLE PRECISION;

-- Add index for better performance on location queries
CREATE INDEX IF NOT EXISTS idx_restaurants_location 
ON restaurants (latitude, longitude);
```

### 步骤 2: 更新餐厅坐标

访问：**http://localhost:3000/admin/update-coords**

1. 点击 **"Update 30 Coordinates"** 按钮
2. 确认对话框点击"确定"
3. 等待完成（约 5-10 秒）
4. 看到成功提示

### 步骤 3: 查看地图

1. 返回主页
2. 点击 **"地图"** 标签（在筛选栏下方）
3. 查看所有餐厅在地图上的位置！

---

## ✨ 功能特性

### 地图视图

**显示内容**：
- 📍 每家餐厅的精确位置（红色标记）
- 🗺️ OpenStreetMap 地图底图
- 📊 筛选条件同样适用

**交互功能**：
- 🖱️ 点击标记查看餐厅信息
- 🔍 缩放地图（滚轮或双指）
- 📱 拖动地图探索区域
- 📸 弹出窗口显示餐厅图片

### 视图切换

**位置**：筛选栏下方
**选项**：
- 📋 **列表视图**：传统卡片布局
- 🗺️ **地图视图**：地理位置展示

**切换方式**：点击按钮即可切换

---

## 📍 地图标记详情

点击地图上的红色标记，会显示：

```
┌─────────────────────┐
│  [餐厅照片]         │
├─────────────────────┤
│  餐厅名称           │
│  菜系类型 • $$      │
│  2 min walk         │
│  123 Street, CBD    │
│  备注说明...        │
│  [View Details →]   │
└─────────────────────┘
```

---

## 🎯 使用场景

### 场景 1: 寻找最近的餐厅
1. 切换到地图视图
2. 查看你当前位置附近的餐厅
3. 点击标记查看详情
4. 选择最近的一家

### 场景 2: 探索新区域
1. 在地图上拖动探索
2. 发现不同街道的餐厅
3. 比较餐厅密集度
4. 规划午餐路线

### 场景 3: 配合筛选使用
1. 设置筛选条件（如：日本料理）
2. 点击"应用"
3. 切换到地图视图
4. 地图只显示符合条件的餐厅

---

## 🗺️ 地图覆盖范围

**中心位置**: Auckland CBD (Queen Street)
**坐标**: -36.848° S, 174.763° E

**覆盖街道**：
- Queen Street（皇后街）
- Lorne Street
- High Street
- Shortland Street
- Federal Street
- Fort Street
- Tyler Street
- Britomart 区域

---

## 📱 移动端优化

### 手机上的地图体验

- ✅ 双指缩放
- ✅ 拖动平移
- ✅ 全屏地图（最大化显示）
- ✅ 响应式弹出窗口
- ✅ 触摸友好的标记

### 桌面端

- ✅ 滚轮缩放
- ✅ 鼠标拖动
- ✅ 更大的视图
- ✅ 详细的弹出信息

---

## 🔧 技术实现

### 使用的技术

- **Leaflet**: 开源地图库
- **OpenStreetMap**: 免费地图数据
- **React-Leaflet**: React 组件封装

### 为什么选择 Leaflet？

- ✅ 完全免费（无 API key）
- ✅ 开源且成熟
- ✅ 轻量级（~38KB）
- ✅ 移动端友好
- ❌ 不需要 Google Maps API（收费）

---

## 📊 坐标数据

### 已添加坐标的餐厅

**30 家餐厅** 都已配置地理坐标：

| 餐厅 | 纬度 | 经度 |
|------|------|------|
| Burger Burger | -36.8485 | 174.7633 |
| Mezze Bar | -36.8475 | 174.7635 |
| Tanuki's Cave | -36.8520 | 174.7645 |
| ... | ... | ... |

### 坐标精度

- 精确到小数点后 4 位
- 精度约 10 米
- 适合街道级别定位

---

## 🎨 地图样式

### 默认样式

- 标准 OpenStreetMap 底图
- 红色标记图标
- 白色弹出窗口
- 清晰的街道标签

### 自定义选项（未来）

可以添加：
- 不同颜色的标记（按菜系分类）
- 聚类标记（多个餐厅在一起时）
- 自定义标记图标
- 深色地图主题

---

## 💡 使用建议

### 日常使用

1. **列表视图**：浏览所有餐厅详细信息
2. **地图视图**：查看位置和距离
3. **配合筛选**：快速找到符合条件且近的餐厅

### 团队决策

1. 看地图确定大家方便的位置
2. 使用筛选缩小范围
3. 点击标记查看详情
4. 或使用随机选择功能

---

## 🔍 故障排除

### 地图不显示

**解决方案**：
1. 确保执行了数据库 SQL
2. 确保更新了餐厅坐标
3. 刷新浏览器
4. 检查浏览器控制台错误

### 标记不显示

**解决方案**：
1. 确认餐厅有坐标数据
2. 检查筛选条件（可能过滤掉了）
3. 放大地图查看

### 地图加载慢

**原因**：
- 首次加载需要下载地图资源
- 移动网络可能较慢

**解决方案**：
- 等待几秒
- 使用 WiFi 获得更好体验

---

## 📈 未来改进

### 短期（可选）

- [ ] 当前位置标记
- [ ] 导航路线
- [ ] 距离计算
- [ ] 标记聚类

### 长期（可选）

- [ ] 自定义标记颜色（按菜系）
- [ ] 热力图显示
- [ ] 离线地图
- [ ] AR 导航

---

## 🎉 完成后效果

设置完成后，主页会有：

```
┌─────────────────────────┐
│  [筛选栏]               │
├─────────────────────────┤
│  [列表] [地图] ← 切换   │
├─────────────────────────┤
│                         │
│     🗺️ 地图视图        │
│     📍 餐厅标记         │
│                         │
└─────────────────────────┘
```

**点击标记 → 看到餐厅详情 → 决定午餐地点** ✨

---

**版本**: 1.0.0  
**更新日期**: 2025-11-27  
**地图供应商**: OpenStreetMap (免费)

