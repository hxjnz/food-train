# 📱 摇一摇功能说明

## 🎯 功能概述

在手机端添加了**摇一摇触发随机选择**功能，让选择午餐更有趣！

---

## ✨ 功能特性

### 1. 自动检测摇动

**工作原理**：
- 使用 DeviceMotion API 检测手机加速度
- 当检测到快速摇动动作时，自动触发随机选择
- 智能过滤误触发（1秒内只触发一次）

### 2. 触觉反馈

**震动提示**：
- 摇动时手机会震动确认
- 震动模式：短-停-短（50ms-100ms-50ms）
- 增强用户体验

### 3. 视觉提示

**首次提示**：
- 页面顶部显示蓝色提示条
- 内容："摇一摇手机试试！" / "Shake your phone!"
- 带弹跳动画，吸引注意
- 可以手动关闭
- 第一次摇动后自动隐藏

---

## 🎮 使用方法

### 在手机上

1. **打开网站**
   - 使用手机浏览器访问网站

2. **允许动作权限**（iOS Safari 需要）
   - 首次使用时可能需要点击允许访问动作传感器

3. **摇一摇**
   - 上下快速摇动手机
   - 感受震动反馈
   - 随机选择器自动弹出！

### 手势说明

```
     ↑
    ╱│╲
   ╱ │ ╲
  ╱  📱 ╲
     │
     ↓
     ↑
     │
    快速
    上下
    摇动
```

**最佳体验**：
- 握住手机
- 上下快速摇动 2-3 次
- 感受震动
- 看到随机选择器弹出

---

## 🔧 技术实现

### DeviceMotion API

```typescript
// 监听设备运动
window.addEventListener('devicemotion', (event) => {
  const acceleration = event.accelerationIncludingGravity;
  // 计算加速度变化
  // 判断是否超过阈值
  // 触发摇动事件
});
```

### 参数配置

```typescript
{
  threshold: 15,    // 摇动灵敏度（越小越灵敏）
  timeout: 1000,    // 防抖时间（毫秒）
  onShake: () => {} // 摇动回调
}
```

### 文件结构

```
hooks/
└── useShakeDetection.ts  // 摇动检测 Hook

app/
└── page.tsx              // 集成摇动功能
```

---

## 🎨 UI 元素

### 提示横幅

**位置**：页面顶部，悬浮显示
**样式**：
- 蓝色背景
- 白色文字
- 圆角矩形
- 弹跳动画
- 手机图标

**显示逻辑**：
- 首次访问时显示
- 摇动一次后自动隐藏
- 可以点击 ✕ 手动关闭
- 仅在移动端显示

---

## 📊 兼容性

### 支持的设备

| 设备/浏览器 | 支持 | 说明 |
|------------|------|------|
| iOS Safari | ✅ | 需要用户授权 |
| iOS Chrome | ✅ | 需要用户授权 |
| Android Chrome | ✅ | 自动支持 |
| Android Firefox | ✅ | 自动支持 |
| 桌面浏览器 | ❌ | 无加速度传感器 |

### iOS 特别说明

**iOS 13+** 需要用户授权访问运动传感器：

1. 首次摇动时会提示
2. 点击"允许"
3. 功能即可正常使用

**检测代码**：
```typescript
if (typeof DeviceMotionEvent !== 'undefined' 
    && typeof DeviceMotionEvent.requestPermission === 'function') {
  // iOS 13+ 需要请求权限
  DeviceMotionEvent.requestPermission();
}
```

---

## 🎯 最佳实践

### 灵敏度调节

**当前设置**：`threshold: 15`

**如果觉得**：
- 太灵敏（轻微移动就触发）→ 增大阈值到 20-25
- 不够灵敏（摇很用力才触发）→ 减小阈值到 10-12

**修改位置**：
```typescript
// app/page.tsx
useShakeDetection({
  threshold: 15, // ← 修改这里
  timeout: 1000,
  onShake: handleShake,
});
```

### 防抖时间

**当前设置**：`timeout: 1000`（1秒）

**作用**：防止连续触发
- 摇动后 1 秒内不会再次触发
- 避免误操作
- 提供更好的用户体验

---

## 🐛 故障排除

### 问题 1: 摇动没反应

**可能原因**：
1. 浏览器不支持
2. iOS 未授权
3. 灵敏度设置太高

**解决方案**：
```typescript
// 检查是否支持
if (window.DeviceMotionEvent) {
  console.log('✅ 支持摇动检测');
} else {
  console.log('❌ 浏览器不支持');
}
```

### 问题 2: iOS 不工作

**解决方案**：
1. 确保使用 HTTPS（本地测试用 localhost）
2. 首次使用时点击"允许"
3. 检查 Safari 设置 > 隐私

### 问题 3: 太灵敏/不灵敏

**解决方案**：调整阈值
```typescript
threshold: 15  // 默认
threshold: 20  // 不太灵敏
threshold: 10  // 更灵敏
```

---

## 🎨 自定义

### 修改震动模式

```typescript
// hooks/useShakeDetection.ts
navigator.vibrate([50, 100, 50]); // 当前模式

// 其他模式：
navigator.vibrate(200);           // 单次长震动
navigator.vibrate([100, 50, 100, 50, 100]); // 多次短震动
navigator.vibrate([30, 30, 30]);  // 快速三连震
```

### 修改提示文本

```typescript
// app/page.tsx
<span>
  {locale === 'zh' ? '摇一摇手机试试！' : 'Shake your phone!'}
</span>

// 可以改成：
{locale === 'zh' ? '试试摇一摇吧！' : 'Try shaking!'}
{locale === 'zh' ? '摇手机抽餐厅！' : 'Shake to pick!'}
```

### 修改提示样式

```typescript
// 当前：蓝色背景
<div className="bg-blue-500">

// 改成：
<div className="bg-purple-500">  // 紫色
<div className="bg-green-500">   // 绿色
<div className="bg-red-500">     // 红色
```

---

## 📈 用户体验提升

### 之前

1. 点击底部"随机选择"按钮
2. 单手操作可能不便

### 现在

1. 方式 A：点击按钮（原有方式）
2. 方式 B：摇一摇手机（新方式）✨
3. 更有趣、更直观
4. 增加互动性

### 优势

- ✅ 更自然的交互方式
- ✅ 增加趣味性
- ✅ 符合移动端使用习惯
- ✅ 震动反馈提升体验
- ✅ 像微信摇一摇一样熟悉

---

## 🚀 未来改进

### 可以添加的功能

1. **摇动动画**
   - 摇动时显示手机图标晃动
   - 增加视觉反馈

2. **摇动统计**
   - 记录用户摇动次数
   - 显示"今日已摇 X 次"

3. **摇动声音**
   - 添加声音效果
   - 可以开关

4. **自定义灵敏度**
   - 用户可以在设置中调节
   - 适应不同使用习惯

5. **摇动成就**
   - "摇动达人"徽章
   - 摇动 10 次、50 次、100 次解锁

---

## 📝 开发笔记

### 为什么使用 DeviceMotion？

- ✅ 标准 Web API
- ✅ 移动设备广泛支持
- ✅ 不需要额外依赖
- ✅ 性能良好

### 为什么添加防抖？

- 防止连续触发
- 避免性能问题
- 提供更好的用户体验

### 为什么添加震动？

- 提供即时反馈
- 确认摇动成功
- 增强沉浸感

---

## 🎉 总结

摇一摇功能为移动端用户提供了更有趣、更直观的交互方式。

**特点**：
- 🎮 有趣的互动体验
- 📱 移动端专属功能
- 🔊 震动反馈
- 💡 智能提示
- ⚡ 响应迅速

**使用场景**：
- 午餐时间，团队成员聚在一起
- 每人摇一摇手机
- 看谁抽中的餐厅
- 增加决策的趣味性

---

**版本**: 1.0.0  
**更新日期**: 2025-11-27  
**兼容性**: iOS 13+, Android 5+

